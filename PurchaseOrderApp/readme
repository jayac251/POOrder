create user orderdbo identified by soademo;

GRANT CONNECT, RESOURCE, DBA TO orderdbo;

GRANT CREATE SESSION, GRANT ANY PRIVILEGE TO orderdbo;

CREATE TABLE MESSAGE_STORE
(
    MSG_GUID VARCHAR2(64) NOT NULL,
    DB_TIMESTAMP DATE DEFAULT SYSDATE NOT NULL,
    LOCALHOST_TIMESTAMP DATE NOT NULL,
    HOST_NAME VARCHAR2(50) NOT NULL,
    STATE VARCHAR2(8) NOT NULL,
    NODE VARCHAR2(128),
    PIPELINE_NAME VARCHAR2(128),
    STAGE_NAME VARCHAR2(128),
    INBOUND_SERVICE_NAME VARCHAR2(256) NOT NULL,
    INBOUND_SERVICE_URI VARCHAR2(128) NOT NULL,
    INBOUND_OPERATION VARCHAR2(64),
    OUTBOUND_SERVICE_NAME VARCHAR2(256),
    OUTBOUND_SERVICE_URI VARCHAR2(256),
    OUTBOUND_OPERATION VARCHAR2(64),
    MSG_LABELS VARCHAR2(2048),
    ERROR_CODE VARCHAR2(64),
    ERROR_REASON VARCHAR2(1024),
    ERROR_DETAILS VARCHAR2(2048)
);

ALTER TABLE MESSAGE_STORE
    ADD CONSTRAINT MESSAGE_STORE_PK PRIMARY KEY (MSG_GUID);

CREATE INDEX IX_MESSAGE_STORE_IED ON MESSAGE_STORE
    (INBOUND_SERVICE_NAME , ERROR_CODE , DB_TIMESTAMP );

CREATE INDEX IX_MESSAGE_STORE_DM ON MESSAGE_STORE
    (DB_TIMESTAMP , MSG_LABELS );
    
    
    CREATE TABLE MESSAGE_STORE_DATA
(
    MSG_GUID VARCHAR2(64) NOT NULL,
    DATA_TYPE INTEGER,
    ENCODING VARCHAR2(24),
    DATA_VALUE BLOB
);

ALTER TABLE MESSAGE_STORE_DATA ADD CONSTRAINT IX_MESSAGE_STORE_DATA UNIQUE
    (MSG_GUID );